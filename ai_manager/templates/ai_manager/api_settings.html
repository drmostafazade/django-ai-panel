{% extends "base.html" %}

{% block title %}تنظیمات API - پنل مدیریت{% endblock %}

{% block content %}
<h1 class="page-title mb-4">تنظیمات API Keys</h1>

<div class="row">
   <div class="col-md-8">
       <div class="card mb-4">
           <div class="card-header bg-light">
               <h5 class="mb-0">اضافه کردن API Key</h5>
           </div>
           <div class="card-body">
               <form method="post" action="{% url 'api_settings' %}">
                   {% csrf_token %}
                   <div class="mb-3">
                       <label class="form-label">انتخاب سرویس AI</label>
                       <select name="provider" class="form-select" required>
                           <option value="">-- انتخاب کنید --</option>
                           {% for provider in providers %}
                           <option value="{{ provider.id }}">{{ provider.get_name_display }}</option>
                           {% endfor %}
                       </select>
                   </div>
                   
                   <div class="mb-3">
                       <label class="form-label">API Key</label>
                       <input type="text" name="api_key" class="form-control" 
                              placeholder="sk-..." required>
                       <small class="text-muted">کلید API خود را از سایت سرویس دهنده دریافت کنید</small>
                   </div>
                   
                   <button type="submit" class="btn btn-primary">
                       ذخیره API Key
                   </button>
               </form>
           </div>
       </div>
       
       <!-- لیست API Keys موجود -->
       <div class="card">
           <div class="card-header bg-light">
               <h5 class="mb-0">API Keys ذخیره شده</h5>
           </div>
           <div class="card-body">
               {% if user_keys %}
               <table class="table">
                   <thead>
                       <tr>
                           <th>سرویس</th>
                           <th>وضعیت</th>
                           <th>آخرین استفاده</th>
                           <th>عملیات</th>
                       </tr>
                   </thead>
                   <tbody>
                       {% for key in user_keys %}
                       <tr>
                           <td>{{ key.provider.get_name_display }}</td>
                           <td>
                               {% if key.is_active %}
                               <span class="badge bg-success">فعال</span>
                               {% else %}
                               <span class="badge bg-secondary">غیرفعال</span>
                               {% endif %}
                           </td>
                           <td>{{ key.last_used|default:"هرگز" }}</td>
                           <td>
                               <form method="post" action="{% url 'toggle_api_key' %}" style="display: inline;">
                                   {% csrf_token %}
                                   <input type="hidden" name="key_id" value="{{ key.id }}">
                                   <button type="submit" class="btn btn-sm btn-outline-primary">
                                       {% if key.is_active %}غیرفعال{% else %}فعال{% endif %}
                                   </button>
                               </form>
                           </td>
                       </tr>
                       {% endfor %}
                   </tbody>
               </table>
               {% else %}
               <p class="text-muted text-center py-4">هنوز API Key ای ذخیره نکرده‌اید</p>
               {% endif %}
           </div>
       </div>
   </div>
   
   <div class="col-md-4">
       <div class="card">
           <div class="card-header bg-light">
               <h5 class="mb-0">راهنما</h5>
           </div>
           <div class="card-body">
               <h6>نحوه دریافت API Key:</h6>
               <ul class="small">
                   <li class="mb-2">
                       <strong>Claude:</strong><br>
                       <a href="https://console.anthropic.com/api" target="_blank">
                           console.anthropic.com
                       </a>
                   </li>
                   <li class="mb-2">
                       <strong>OpenAI:</strong><br>
                       <a href="https://platform.openai.com/api-keys" target="_blank">
                           platform.openai.com
                       </a>
                   </li>
                   <li class="mb-2">
                       <strong>Google Gemini:</strong><br>
                       <a href="https://makersuite.google.com/app/apikey" target="_blank">
                           makersuite.google.com
                       </a>
                   </li>
               </ul>
               
               <div class="alert alert-warning mt-3">
                   <small>
                       <strong>توجه:</strong> API Key های خود را محرمانه نگه دارید
                   </small>
               </div>
           </div>
       </div>
   </div>
</div>
{% endblock %}
