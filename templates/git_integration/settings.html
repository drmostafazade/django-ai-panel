{% extends 'base/base.html' %}
{% block title %}تنظیمات Git{% endblock %}

{% block content %}
<hgroup>
    <h1>تنظیمات GitHub</h1>
    <p>توکن دسترسی شخصی خود را وارد کنید</p>
</hgroup>

<div class="grid">
    <article>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="save_token">
            
            <label for="github_token">
                GitHub Personal Access Token
                <input type="password" id="github_token" name="github_token" 
                       placeholder="ghp_xxxxxxxxxxxx"
                       {% if token %}value="••••••••••"{% endif %}>
                <small>
                    <a href="https://github.com/settings/tokens/new" target="_blank">
                        دریافت توکن جدید از GitHub
                    </a>
                </small>
            </label>
            
            <div class="grid">
                <button type="submit">ذخیره توکن</button>
                <button type="button" class="secondary" onclick="testConnection()">
                    تست اتصال
                </button>
            </div>
        </form>
        
        {% if token %}
        <hr>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="sync_repos">
            <button type="submit" class="contrast">
                <i class="bi bi-arrow-repeat"></i> همگام‌سازی مخازن
            </button>
        </form>
        {% endif %}
    </article>
    
    <aside>
        <h3>راهنما</h3>
        <p>برای دریافت توکن GitHub:</p>
        <ol>
            <li>به تنظیمات GitHub بروید</li>
            <li>Developer settings را انتخاب کنید</li>
            <li>Personal access tokens → Tokens (classic)</li>
            <li>Generate new token</li>
            <li>دسترسی repo را انتخاب کنید</li>
        </ol>
    </aside>
</div>

<script>
function testConnection() {
    const token = document.getElementById('github_token').value;
    if (!token) {
        alert('لطفاً توکن را وارد کنید');
        return;
    }
    // TODO: implement AJAX test
    alert('در حال تست...');
}
</script>
{% endblock %}
